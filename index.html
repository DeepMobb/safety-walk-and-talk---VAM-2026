<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Walk & Talk 2026 - Opdateret Team</title>
    <style>
        :root {
            --color-fixed: #27ae60; /* Green for Martin/Kasper */
            --color-team: #2980b9;  /* Blue for Team */
            --color-maint: #f39c12; /* Orange for Maintenance */
            --bg-header: #2c3e50;
            --bg-btn: #2980b9;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f0f2f5; 
            color: #333; 
            padding: 20px; 
            margin: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            padding-bottom: 20px;
        }

        h1 { text-align: center; color: var(--bg-header); margin-top: 30px; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 20px; font-size: 0.9em; }

        /* Controls */
        .controls {
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px;
            background-color: #ecf0f1; padding: 20px; margin-bottom: 20px; border-bottom: 1px solid #bdc3c7;
        }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.8em; font-weight: bold; color: #7f8c8d; }
        select, input[type="time"] { padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
        .btn {
            padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: bold;
            transition: background 0.2s; color: white; height: 42px; margin-top: 19px;
        }
        .btn-outlook { background-color: var(--bg-btn); display: none; }
        .btn-outlook:hover { background-color: #1c5980; }
        .btn-print { background-color: #7f8c8d; }
        .btn-print:hover { background-color: #616b6b; }

        /* Grid - No Date Column */
        .header-row {
            display: grid; grid-template-columns: 60px 1fr 1fr;
            background-color: var(--bg-header); color: white; font-weight: bold;
            padding: 12px 15px; position: sticky; top: 0; font-size: 0.95em;
        }
        .row {
            display: grid; grid-template-columns: 60px 1fr 1fr;
            border-bottom: 1px solid #eee; align-items: center; min-height: 44px; font-size: 0.9em;
        }
        .row:nth-child(even) { background-color: #fafafa; }
        
        .col-week { text-align: center; font-weight: bold; color: #7f8c8d; border-right: 1px solid #eee; display: flex; align-items: center; justify-content: center; height: 100%; }
        
        .bar-cell { padding: 4px 8px; height: 100%; display: flex; flex-direction: column; justify-content: center; gap: 2px; }
        
        .bar {
            height: 26px; border-radius: 4px; display: flex; align-items: center;
            padding-left: 10px; color: white; width: 100%; font-weight: 500; font-size: 0.85em;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .bar.fixed { background-color: var(--color-fixed); }
        .bar.team { background-color: var(--color-team); }
        
        /* Special Rows */
        .quarter-divider {
            background-color: #dfe6e9; color: #2d3436; padding: 8px 15px;
            font-size: 0.85em; text-transform: uppercase; font-weight: bold;
            border-top: 2px solid #bdc3c7; border-bottom: 1px solid #bdc3c7;
        }
        .row.maintenance { background-color: #fff3cd !important; border-bottom: 1px solid #f1c40f; }
        .maint-label { 
            font-size: 0.75em; color: #d35400; font-weight: bold; text-transform: uppercase; margin-bottom: 2px;
        }

        /* Legend */
        .legend { display: flex; justify-content: center; gap: 20px; padding: 10px; font-size: 0.85em; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

        @media print {
            .controls, .btn { display: none; }
            body { background: white; }
            .container { box-shadow: none; }
            .row.maintenance { background-color: #fff3cd !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Safety Walk & Talk 2026</h1>
    <div class="subtitle">Inkl. Vedligeholdelsesstop (Uge 28-30)</div>

    <div class="legend">
        <div class="legend-item"><div class="dot" style="background:var(--color-fixed)"></div><div>FVP (Martin) / FVV (Kasper)</div></div>
        <div class="legend-item"><div class="dot" style="background:var(--color-team)"></div><div>Team Rotation</div></div>
        <div class="legend-item"><div class="dot" style="background:var(--color-maint)"></div><div>Vedligeholdelsesstop</div></div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label for="nameFilter">V√¶lg Navn:</label>
            <select id="nameFilter" onchange="filterSchedule()">
                <option value="Alle">Vis Alle</option>
                <option disabled>--- Faste (Ulige uger) ---</option>
                <option value="Martin">Martin (FVP)</option>
                <option value="Kasper">Kasper (FVV)</option>
                <option disabled>--- Team (Lige uger) ---</option>
                <option value="Hans">Hans</option>
                <option value="Johannes">Johannes</option>
                <option value="Kristian">Kristian</option>
                <option value="Charlotte">Charlotte</option>
                <option value="Claus">Claus</option>
            </select>
        </div>

        <div class="control-group" id="timeGroup" style="display:none;">
            <label for="timeSelect">Foretrukket tidspunkt:</label>
            <input type="time" id="timeSelect" value="09:00">
        </div>
        
        <button class="btn btn-outlook" id="outlookBtn" onclick="downloadICS()">üìÖ Hent kalenderfil</button>
        <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print</button>
    </div>

    <div class="header-row">
        <div>Uge</div>
        <div>Faste (Ulige)</div>
        <div>Team (Lige)</div>
    </div>

    <div id="schedule-container"></div>
</div>

<script>
    // Configuration
    const linkChecklist = "https://eropexvam.ecos.dk/#/tjeklister/60af5160f88629d31c4b935e";
    const linkSharepoint = "https://rockwool.sharepoint.com/:w:/s/RWNordics/Departments/Production/Internal/VAM/EabLKDtF_nFIs0A-qfqKeSEBbLyUGrvSKyneHZ5dpMairA?e=JamNcN";

    // Data Structure
    // Participants: Hans, Johannes, Kristian, Charlotte, Claus (5 people)
    // Rotation logic: Ensuring all walk with all over time.
    
    const schedule = [
        { q: "1. Kvartal", w: 2, type: "team", p1: "Hans", p2: "Johannes", dateISO: "20260105" },
        { w: 3, type: "fixed", dateISO: "20260112" },
        { w: 4, type: "team", p1: "Kristian", p2: "Charlotte", dateISO: "20260119" },
        { w: 5, type: "fixed", dateISO: "20260126" },
        { w: 6, type: "team", p1: "Claus", p2: "Hans", dateISO: "20260202" },
        { w: 7, type: "fixed", dateISO: "20260209" },
        { w: 8, type: "team", p1: "Johannes", p2: "Kristian", dateISO: "20260216" },
        { w: 9, type: "fixed", dateISO: "20260223" },
        { w: 10, type: "team", p1: "Charlotte", p2: "Claus", dateISO: "20260302" },
        { w: 11, type: "fixed", dateISO: "20260309" },
        { w: 12, type: "team", p1: "Hans", p2: "Kristian", dateISO: "20260316" },
        { w: 13, type: "fixed", txt: "P√•skeuge", dateISO: "20260323" },

        { q: "2. Kvartal", w: 14, type: "team", p1: "Johannes", p2: "Claus", dateISO: "20260330" },
        { w: 15, type: "fixed", dateISO: "20260406" },
        { w: 16, type: "team", p1: "Charlotte", p2: "Hans", dateISO: "20260413" },
        { w: 17, type: "fixed", dateISO: "20260420" },
        { w: 18, type: "team", p1: "Claus", p2: "Kristian", dateISO: "20260427" },
        { w: 19, type: "fixed", dateISO: "20260504" },
        { w: 20, type: "team", p1: "Johannes", p2: "Charlotte", dateISO: "20260511" },
        { w: 21, type: "fixed", dateISO: "20260518" },
        { w: 22, type: "team", p1: "Hans", p2: "Johannes", dateISO: "20260525" }, // Rotation restart/cycle
        { w: 23, type: "fixed", dateISO: "20260601" },
        { w: 24, type: "team", p1: "Kristian", p2: "Charlotte", dateISO: "20260608" },
        { w: 25, type: "fixed", dateISO: "20260615" },
        { w: 26, type: "team", p1: "Claus", p2: "Hans", dateISO: "20260622" },
        { w: 27, type: "fixed", dateISO: "20260629" },
        
        // MAINTENANCE STOP (28, 29, 30) - Active weeks
        { q: "Vedligeholdelsesstop (Sommer)", w: 28, type: "team", p1: "Johannes", p2: "Kristian", maint: true, dateISO: "20260706" },
        { w: 29, type: "fixed", maint: true, dateISO: "20260713" },
        { w: 30, type: "team", p1: "Charlotte", p2: "Claus", maint: true, dateISO: "20260720" },

        { q: "3. Kvartal", w: 31, type: "fixed", dateISO: "20260727" },
        { w: 32, type: "team", p1: "Hans", p2: "Kristian", dateISO: "20260803" },
        { w: 33, type: "fixed", dateISO: "20260810" },
        { w: 34, type: "team", p1: "Johannes", p2: "Claus", dateISO: "20260817" },
        { w: 35, type: "fixed", dateISO: "20260824" },
        { w: 36, type: "team", p1: "Charlotte", p2: "Hans", dateISO: "20260831" },
        { w: 37, type: "fixed", dateISO: "20260907" },
        { w: 38, type: "team", p1: "Claus", p2: "Kristian", dateISO: "20260914" },
        { w: 39, type: "fixed", dateISO: "20260921" },

        { q: "4. Kvartal", w: 40, type: "team", p1: "Johannes", p2: "Charlotte", dateISO: "20260928" },
        { w: 41, type: "fixed", dateISO: "20261005" },
        { w: 42, type: "team", p1: "Hans", p2: "Johannes", dateISO: "20261012" },
        { w: 43, type: "fixed", dateISO: "20261019" },
        { w: 44, type: "team", p1: "Kristian", p2: "Charlotte", dateISO: "20261026" },
        { w: 45, type: "fixed", dateISO: "20261102" },
        { w: 46, type: "team", p1: "Claus", p2: "Hans", dateISO: "20261109" },
        { w: 47, type: "fixed", dateISO: "20261116" },
        { w: 48, type: "team", p1: "Johannes", p2: "Kristian", dateISO: "20261123" },
        { w: 49, type: "fixed", dateISO: "20261130" },
        { w: 50, type: "team", p1: "Charlotte", p2: "Claus", dateISO: "20261207" },
        { w: 51, type: "fixed", dateISO: "20261214" },
        { w: 52, type: "team", p1: "Hans", p2: "Kristian", dateISO: "20261221" },
        { w: 53, type: "fixed", txt: "Nyt√•r", dateISO: "20261228" },
    ];

    function filterSchedule() {
        const selectedName = document.getElementById('nameFilter').value;
        const container = document.getElementById('schedule-container');
        const outlookBtn = document.getElementById('outlookBtn');
        const timeGroup = document.getElementById('timeGroup');
        
        container.innerHTML = '';
        
        // UI State
        if (selectedName !== "Alle") {
            outlookBtn.style.display = "block";
            timeGroup.style.display = "flex";
            outlookBtn.innerText = `üìÖ Hent ${selectedName}s kalenderfil`;
        } else {
            outlookBtn.style.display = "none";
            timeGroup.style.display = "none";
        }

        schedule.forEach(item => {
            let show = false;
            
            // Filtering Logic
            if (selectedName === "Alle") {
                show = true;
            } else if (item.type === 'team') {
                if (item.p1 === selectedName || item.p2 === selectedName) show = true;
            } else if (item.type === 'fixed') {
                if (selectedName === 'Martin' || selectedName === 'Kasper') show = true;
            }

            if (!show) return;

            // Render Quarter
            if (item.q) {
                const div = document.createElement('div');
                div.className = 'quarter-divider';
                div.innerText = item.q;
                container.appendChild(div);
            }

            // Render Row
            const row = document.createElement('div');
            row.className = item.maint ? 'row maintenance' : 'row';

            // Uge
            let html = `<div class="col-week">${item.w}</div>`;

            // Column 1: Fixed (Martin/Kasper)
            html += `<div class="bar-cell">`;
            if (item.type === 'fixed') {
                let labelMartin = "Martin (FVP)";
                let labelKasper = "Kasper (FVV)";
                if(item.txt) { labelMartin += ` (${item.txt})`; labelKasper += ` (${item.txt})`; }

                if (selectedName === "Alle") {
                    html += `<div class="bar fixed" style="font-size:0.75em">${labelMartin}</div>`;
                    html += `<div class="bar fixed" style="font-size:0.75em">${labelKasper}</div>`;
                } else if (selectedName === "Martin") {
                    html += `<div class="bar fixed">${labelMartin}</div>`;
                } else if (selectedName === "Kasper") {
                    html += `<div class="bar fixed">${labelKasper}</div>`;
                }
            }
            if(item.maint && item.type === 'fixed') html += `<div class="maint-label">Vedligehold</div>`;
            html += `</div>`;

            // Column 2: Team
            html += `<div class="bar-cell">`;
            if (item.type === 'team') {
                let pText = `${item.p1} & ${item.p2}`;
                html += `<div class="bar team">${pText}</div>`;
            }
            if(item.maint && item.type === 'team') html += `<div class="maint-label">Vedligehold</div>`;
            html += `</div>`;

            row.innerHTML = html;
            container.appendChild(row);
        });
    }

    function getFullOverviewText(name) {
        let text = "\\n--- DIN OVERSIGT FOR 2026 ---\\n";
        schedule.forEach(item => {
            let isRelevant = false;
            let info = "";

            if (item.type === 'fixed') {
                if (name === 'Martin') { isRelevant = true; info = "FVP Rundgang"; }
                if (name === 'Kasper') { isRelevant = true; info = "FVV Rundgang"; }
            } else if (item.type === 'team') {
                if (item.p1 === name || item.p2 === name) {
                    isRelevant = true;
                    const partner = item.p1 === name ? item.p2 : item.p1;
                    info = `Med ${partner}`;
                }
            }

            if (isRelevant) {
                let extra = item.maint ? " (Vedligeholdelsesstop)" : "";
                text += `Uge ${item.w}: ${info}${extra}\\n`;
            }
        });
        return text;
    }

    function downloadICS() {
        const name = document.getElementById('nameFilter').value;
        const timeVal = document.getElementById('timeSelect').value;
        
        if (name === "Alle") return alert("V√¶lg venligst et navn f√∏rst.");

        const [hours, minutes] = timeVal.split(':');
        
        const placeholderText = "Disse er placeholdere - husk selv at arrangere i din kalender Safety Walk med din kollega, eller alene.\\n\\n";
        const linkText = `Husk at registrere g√•ede rundgange i checklisten via:\\n${linkChecklist} (Link)\\n\\nDu kan finde Group sp√∏rgeskemaet via:\\n${linkSharepoint} (Link)\\n`;
        const descHeader = placeholderText + linkText;
        const descFooter = getFullOverviewText(name);

        let icsContent = "BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//SafetyWalk//DK\r\nCALSCALE:GREGORIAN\r\nMETHOD:PUBLISH\r\n";
        
        schedule.forEach(item => {
            let isRelevant = false;
            let summary = "";

            if (item.type === 'fixed') {
                if (name === 'Martin') { isRelevant = true; summary = "Reminder: FVP med Martin"; }
                if (name === 'Kasper') { isRelevant = true; summary = "Reminder: FVV med Kasper"; }
            } else if (item.type === 'team') {
                if (item.p1 === name || item.p2 === name) {
                    isRelevant = true;
                    const partner = item.p1 === name ? item.p2 : item.p1;
                    summary = `Reminder: Safety Walk med ${partner}`;
                }
            }

            if (isRelevant && item.dateISO) {
                const dtStart = `${item.dateISO}T${hours}${minutes}00`;
                let endH = parseInt(hours);
                let endM = parseInt(minutes) + 30;
                if(endM >= 60) { endH++; endM -= 60; }
                const endHStr = endH.toString().padStart(2, '0');
                const endMStr = endM.toString().padStart(2, '0');
                const dtEnd = `${item.dateISO}T${endHStr}${endMStr}00`;
                
                if(item.maint) summary += " (Vedligehold)";

                const fullDescription = descHeader + descFooter;

                icsContent += "BEGIN:VEVENT\r\n";
                icsContent += `SUMMARY:${summary}\r\n`;
                icsContent += `DTSTART:${dtStart}\r\n`;
                icsContent += `DTEND:${dtEnd}\r\n`;
                icsContent += `DESCRIPTION:${fullDescription}\r\n`;
                icsContent += "STATUS:CONFIRMED\r\n";
                icsContent += "TRANSP:OPAQUE\r\n"; 
                icsContent += "END:VEVENT\r\n";
            }
        });

        icsContent += "END:VCALENDAR";

        const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
        const link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.setAttribute('download', `SafetyWalk_2026_${name}.ics`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Initialize
    filterSchedule();
</script>

</body>
</html>
